# ES2021 æ–°ç‰¹æ€§

åˆšè¿›å…¥ 2021 å¹´ï¼ŒES2021 ä¹Ÿå‡ºæ¥äº†ï¼Œè¿™æ¬¡åˆå¸¦æ¥äº†å“ªäº›æœ‰è¶£çš„ç‰¹æ€§å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ¥äº†è§£ä¸‹ã€‚[ææ¡ˆ](https://tc39.es/ecma262/)

## String.prototype.replaceAll()

å¦‚æœè¦ç”¨`replace()`æ›¿æ¢å…¨éƒ¨çš„å­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨æ­£åˆ™ã€‚

```javascript
let str = "mike name is mike";
let str2 = str.replace(/mike/g, "fake");
console.log(str2); // "fake name is fake"
```

ç°åœ¨å¯ä»¥ç”¨`String.prototype.replaceAll()`æ›¿æ¢å…¨éƒ¨å­—ç¬¦ä¸²è€Œä¸éœ€è¦ä½¿ç”¨æ­£åˆ™ã€‚

```javascript
let str = "mike name is mike";
let str3 = str.replaceAll("mike", "fake"); // ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ­£åˆ™ä¹Ÿå¯ä»¥ï¼š/mike/æˆ–/mike/g
console.log(str3); // "fake name is fake"
```

## Promise.any()

å½“æœ‰ä»»ä½•ä¸€ä¸ª promise çŠ¶æ€å˜ä¸ºæˆåŠŸ(fulfilled)ï¼Œå°±è¿”å›ã€‚å½“å…¨éƒ¨ promise éƒ½ rejectedï¼ŒæŠ›å‡ºä¸€ä¸ª AggregateError é”™è¯¯ã€‚

```javascript
const p1 = new Promise((resolve, reject) => {
  setTimeout(() => resolve("p1"), 100);
});
const p2 = new Promise((resolve, reject) => {
  setTimeout(() => resolve("p2"), 200);
});
const p3 = new Promise((resolve, reject) => {
  setTimeout(() => resolve("p3"), 300);
});
Promise.any([p1, p2, p3])
  .then((first) => {
    // ä»»ä½•ä¸€ä¸ªpromiseå®Œæˆ(fulfilled)ï¼Œå°±è¿”å›
    console.log(first);
  })
  .catch((error) => {
    // å…¨éƒ¨promiseéƒ½rejectedï¼ŒæŠ›å‡ºä¸€ä¸ªAggregateErroré”™è¯¯
    console.log(error);
  });
```

**ç±»ä¼¼ api**
| åå­— | æè¿° | |
|------|------------|------------|
|Promise.allSettled |ä¸ä¼šçŸ­è·¯ | ES2020 |
|Promise.all |å½“æœ‰ä¸€ä¸ª rejected å°±çŸ­è·¯ | ES2015 |
|Promise.race |å½“æœ‰ä¸€ä¸ª rejected æˆ– fulfilled å°±çŸ­è·¯ | ES2015 |
|Promise.any |å½“æœ‰ä¸€ä¸ª fulfilled å°±çŸ­è·¯ | ES2021 |

## WeakRefs

[MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakRef#Avoid_where_possible)ğŸ‘ˆ
WeakRef å¯¹è±¡åŒ…å«å¯¹å¯¹è±¡çš„å¼±å¼•ç”¨ã€‚å¯¹è±¡çš„å¼±å¼•ç”¨æ˜¯æŒ‡å½“è¯¥å¯¹è±¡åº”è¯¥è¢« GC(garbage collector)å›æ”¶æ—¶ä¸ä¼šé˜»æ­¢ GC çš„å›æ”¶è¡Œä¸ºã€‚**æœ€å¥½é¿å…ä½¿ç”¨ã€‚**

```JavaScript
const obj = new WeakRef({
	name: 'mark'
})
console.log(obj.deref().name) // "mark"
```

`WeakRef.prototype.deref()`è¿”å› WeakRef æ‰€ç»‘å®šçš„å¯¹è±¡ã€‚

## Logical Assignment Operators

é€»è¾‘èµ‹å€¼è¿ç®—ç¬¦ï¼Œç›®çš„æ˜¯æä¾›ç®€æ´çš„å†™æ³•ã€‚

```JavaScript
a ||= b;
// ç­‰æ•ˆäºä»¥ä¸‹ä¸¤ç§å†™æ³•
// a || (a = b); aä¸ºfalsyæ—¶æ‰§è¡Œå³è¾¹
// if(!a) a = b;

a &&= b;
// ç­‰æ•ˆäºä»¥ä¸‹ä¸¤ç§å†™æ³•
// a && (a = b); aä¸ºtruthæ—¶æ‰§è¡Œå³è¾¹
// if(a) a = b

a ??= b;
// ç­‰æ•ˆäºä»¥ä¸‹ä¸¤ç§å†™æ³•
// a ?? (a = b); aä¸ºundefinedæˆ–nullæ—¶æ‰§è¡Œå³è¾¹
// if(a === nudefined || a === null) a = b;
```

å…¶ä¸­`??`è¿ç®—ç¬¦åªæœ‰å·¦è¾¹æ˜¯`undefined`æˆ–`null`æ‰è¿”å›å³è¾¹ã€‚

```JavaScript
undefined ?? 1 // 1
null ?? 1 // 1
false ?? 1 // false
0 ?? 1 // 0
"" ?? 1 // ""
NaN ?? 1 // NaN
2 ?? 1 // 2
```

## Numeric Separators

æ•°å­—åˆ†éš”ç¬¦\_(ä¸‹åˆ’çº¿)ï¼Œå¢åŠ æ•°å­—å¯è¯»æ€§ã€‚

```JavaScript
let fee = 123_00;
console.log(fee); // 12300
let fee = 12_300;
console.log(fee); // 12300
```

- [tc39 å„ä¸ªé˜¶æ®µçš„ææ¡ˆ](https://github.com/tc39/ecma262)
